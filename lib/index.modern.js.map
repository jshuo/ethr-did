{"version":3,"file":"index.modern.js","sources":["../src/index.ts"],"sourcesContent":["import { createJWT, ES256KSigner, ES256Signer, hexToBytes, JWTVerified, Signer as JWTSigner, verifyJWT } from 'did-jwt'\nimport { Signer as TxSigner } from '@ethersproject/abstract-signer'\nimport { CallOverrides } from '@ethersproject/contracts'\nimport { computeAddress } from '@ethersproject/transactions'\nimport { computePublicKey } from '@ethersproject/signing-key'\nimport { Provider } from '@ethersproject/providers'\nimport { Wallet } from '@ethersproject/wallet'\nimport * as base64 from '@ethersproject/base64'\nimport { hexlify, hexValue, isBytes } from '@ethersproject/bytes'\nimport { Base58 } from '@ethersproject/basex'\nimport { toUtf8Bytes } from '@ethersproject/strings'\nimport { EthrDidController, interpretIdentifier, MetaSignature, REGISTRY } from 'ethr-did-resolver'\nimport { Resolvable } from 'did-resolver'\nimport { ec as EC } from 'elliptic';\n\nexport enum DelegateTypes {\n  veriKey = 'veriKey',\n  sigAuth = 'sigAuth',\n  enc = 'enc',\n}\n\ninterface IConfig {\n  identifier: string\n  chainNameOrId?: string | number\n\n  registry?: string\n\n  signer?: JWTSigner\n  alg?: 'ES256K' | 'ES256K-R'\n  txSigner?: TxSigner\n  privateKey?: string\n\n  rpcUrl?: string\n  provider?: Provider\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  web3?: any\n}\n\nexport type KeyPair = {\n  address: string\n  privateKey: string\n  publicKey: string\n  identifier: string\n}\n\ntype DelegateOptions = {\n  delegateType?: DelegateTypes\n  expiresIn?: number\n}\n\nexport class EthrDID {\n  public did: string\n  public address: string\n  public signer?: JWTSigner\n  public alg?: 'ES256K' | 'ES256K-R'\n  private owner?: string\n  private controller?: EthrDidController\n\n  constructor(conf: IConfig) {\n    const { address, publicKey, network } = interpretIdentifier(conf.identifier)\n    const chainNameOrId = typeof conf.chainNameOrId === 'number' ? hexValue(conf.chainNameOrId) : conf.chainNameOrId\n    if (conf.provider || conf.rpcUrl || conf.web3) {\n      let txSigner = conf.txSigner\n      if (conf.privateKey && typeof txSigner === 'undefined') {\n        txSigner = new Wallet(conf.privateKey)\n      }\n      this.controller = new EthrDidController(\n        conf.identifier,\n        undefined,\n        txSigner,\n        chainNameOrId,\n        conf.provider || conf.web3?.currentProvider,\n        conf.rpcUrl,\n        conf.registry || REGISTRY\n      )\n      this.did = this.controller.did\n    } else {\n      const net = network || chainNameOrId\n      let networkString = net ? `${net}:` : ''\n      if (networkString in ['mainnet:', '0x1:']) {\n        networkString = ''\n      }\n      this.did =\n        typeof publicKey === 'string' ? `did:ethr:${networkString}${publicKey}` : `did:ethr:${networkString}${address}`\n    }\n    this.address = address\n    if (conf.signer) {\n      this.signer = conf.signer\n      this.alg = conf.alg\n      if (!this.alg) {\n        console.warn(\n          'A JWT signer was specified but no algorithm was set. Please set the `alg` parameter when calling `new EthrDID()`'\n        )\n      }\n    } else if (conf.privateKey) {\n      this.signer = ES256KSigner(hexToBytes(conf.privateKey), true)\n      this.alg = 'ES256K-R'\n    }\n  }\n\n  static createKeyPair(chainNameOrId?: string | number): KeyPair {\n    const ec = new EC('p256'); // 'p256' is another name for secp256r1\n\n// Generate a key pair\n    const keyPair = ec.genKeyPair();\n    const privateKey = '0x' + keyPair.getPrivate('hex');\n    const address = computeAddress(privateKey)\n    const publicKey = computePublicKey(privateKey, true)\n    const net = typeof chainNameOrId === 'number' ? hexValue(chainNameOrId) : chainNameOrId\n    const identifier = net ? `did:ethr:${net}:${publicKey}` : publicKey\n    return { address, privateKey, publicKey, identifier }\n  }\n\n  async lookupOwner(cache = true): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    if (cache && this.owner) return this.owner\n    return this.controller?.getOwner(this.address)\n  }\n\n  async changeOwner(newOwner: string, txOptions?: CallOverrides): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.changeOwner(newOwner, {\n      ...txOptions,\n      from: owner,\n    })\n    this.owner = newOwner\n    return receipt.transactionHash\n  }\n\n  async createChangeOwnerHash(newOwner: string): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createChangeOwnerHash(newOwner)\n  }\n\n  async changeOwnerSigned(newOwner: string, signature: MetaSignature, txOptions: CallOverrides): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.changeOwnerSigned(newOwner, signature, txOptions)\n    this.owner = newOwner\n    return receipt.transactionHash\n  }\n\n  async addDelegate(\n    delegate: string,\n    delegateOptions?: DelegateOptions,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.addDelegate(\n      delegateOptions?.delegateType || DelegateTypes.veriKey,\n      delegate,\n      delegateOptions?.expiresIn || 86400,\n      { ...txOptions, from: owner }\n    )\n    return receipt.transactionHash\n  }\n\n  async createAddDelegateHash(delegateType: string, delegateAddress: string, exp: number): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createAddDelegateHash(delegateType, delegateAddress, exp)\n  }\n\n  async addDelegateSigned(\n    delegate: string,\n    signature: MetaSignature,\n    delegateOptions?: DelegateOptions,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.addDelegateSigned(\n      delegateOptions?.delegateType || DelegateTypes.veriKey,\n      delegate,\n      delegateOptions?.expiresIn || 86400,\n      signature,\n      txOptions\n    )\n    return receipt.transactionHash\n  }\n\n  async revokeDelegate(\n    delegate: string,\n    delegateType = DelegateTypes.veriKey,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.revokeDelegate(delegateType, delegate, { ...txOptions, from: owner })\n    return receipt.transactionHash\n  }\n\n  async createRevokeDelegateHash(delegateType: string, delegateAddress: string): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createRevokeDelegateHash(delegateType, delegateAddress)\n  }\n\n  async revokeDelegateSigned(\n    delegate: string,\n    delegateType = DelegateTypes.veriKey,\n    signature: MetaSignature,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.revokeDelegateSigned(delegateType, delegate, signature, txOptions)\n    return receipt.transactionHash\n  }\n\n  async setAttribute(\n    key: string,\n    value: string | Uint8Array,\n    expiresIn = 86400,\n    /** @deprecated please use `txOptions.gasLimit` */\n    gasLimit?: number,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.setAttribute(key, attributeToHex(key, value), expiresIn, {\n      gasLimit,\n      ...txOptions,\n      from: owner,\n    })\n    return receipt.transactionHash\n  }\n\n  async createSetAttributeHash(attrName: string, attrValue: string, exp: number) {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createSetAttributeHash(attrName, attrValue, exp)\n  }\n\n  async setAttributeSigned(\n    key: string,\n    value: string | Uint8Array,\n    expiresIn = 86400,\n    signature: MetaSignature,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.setAttributeSigned(\n      key,\n      attributeToHex(key, value),\n      expiresIn,\n      signature,\n      txOptions\n    )\n    return receipt.transactionHash\n  }\n\n  async revokeAttribute(\n    key: string,\n    value: string | Uint8Array,\n    /** @deprecated please use `txOptions.gasLimit` */\n    gasLimit?: number,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.revokeAttribute(key, attributeToHex(key, value), {\n      gasLimit,\n      ...txOptions,\n      from: owner,\n    })\n    return receipt.transactionHash\n  }\n\n  async createRevokeAttributeHash(attrName: string, attrValue: string) {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createRevokeAttributeHash(attrName, attrValue)\n  }\n\n  async revokeAttributeSigned(\n    key: string,\n    value: string | Uint8Array,\n    signature: MetaSignature,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.revokeAttributeSigned(key, attributeToHex(key, value), signature, txOptions)\n    return receipt.transactionHash\n  }\n\n  // Create a temporary signing delegate able to sign JWT on behalf of identity\n  async createSigningDelegate(\n    delegateType = DelegateTypes.veriKey,\n    expiresIn = 86400\n  ): Promise<{ kp: KeyPair; txHash: string }> {\n    const kp = EthrDID.createKeyPair()\n    this.signer = ES256Signer(hexToBytes(kp.privateKey))\n    const txHash = await this.addDelegate(kp.address, {\n      delegateType,\n      expiresIn,\n    })\n    return { kp, txHash }\n  }\n\n  // eslint-disable-next-line\n  async signJWT(payload: any, expiresIn?: number): Promise<string> {\n    if (typeof this.signer !== 'function') {\n      throw new Error('No signer configured')\n    }\n    const options = {\n      signer: this.signer,\n      alg: 'ES256',\n      issuer: this.did,\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if (expiresIn) (<any>options)['expiresIn'] = expiresIn\n    return createJWT(payload, options)\n  }\n\n  async verifyJWT(jwt: string, resolver: Resolvable, audience = this.did): Promise<JWTVerified> {\n    return verifyJWT(jwt, { resolver, audience })\n  }\n}\n\nfunction attributeToHex(key: string, value: string | Uint8Array): string {\n  if (value instanceof Uint8Array || isBytes(value)) {\n    return hexlify(value)\n  }\n  const matchKeyWithEncoding = key.match(/^did\\/(pub|auth|svc)\\/(\\w+)(\\/(\\w+))?(\\/(\\w+))?$/)\n  const encoding = matchKeyWithEncoding?.[6]\n  const matchHexString = (<string>value).match(/^0x[0-9a-fA-F]*$/)\n  if (encoding && !matchHexString) {\n    if (encoding === 'base64') {\n      return hexlify(base64.decode(value))\n    }\n    if (encoding === 'base58') {\n      return hexlify(Base58.decode(value))\n    }\n  } else if (matchHexString) {\n    return <string>value\n  }\n\n  return hexlify(toUtf8Bytes(value))\n}\n"],"names":["DelegateTypes","EthrDID","constructor","conf","did","address","signer","alg","owner","controller","publicKey","network","interpretIdentifier","identifier","chainNameOrId","hexValue","provider","rpcUrl","web3","txSigner","privateKey","Wallet","EthrDidController","undefined","currentProvider","registry","REGISTRY","net","networkString","console","warn","ES256KSigner","hexToBytes","createKeyPair","ec","EC","keyPair","genKeyPair","getPrivate","computeAddress","computePublicKey","lookupOwner","cache","Error","getOwner","changeOwner","newOwner","txOptions","receipt","from","transactionHash","createChangeOwnerHash","changeOwnerSigned","signature","addDelegate","delegate","delegateOptions","delegateType","veriKey","expiresIn","createAddDelegateHash","delegateAddress","exp","addDelegateSigned","revokeDelegate","createRevokeDelegateHash","revokeDelegateSigned","setAttribute","key","value","gasLimit","attributeToHex","createSetAttributeHash","attrName","attrValue","setAttributeSigned","revokeAttribute","createRevokeAttributeHash","revokeAttributeSigned","createSigningDelegate","kp","ES256Signer","txHash","signJWT","payload","options","issuer","createJWT","verifyJWT","jwt","resolver","audience","Uint8Array","isBytes","hexlify","matchKeyWithEncoding","match","encoding","matchHexString","base64","decode","Base58","toUtf8Bytes"],"mappings":"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"}