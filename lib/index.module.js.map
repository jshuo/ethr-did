{"version":3,"file":"index.module.js","sources":["../src/index.ts"],"sourcesContent":["import { createJWT, ES256KSigner, ES256Signer, hexToBytes, JWTVerified, Signer as JWTSigner, verifyJWT } from 'did-jwt'\nimport { Signer as TxSigner } from '@ethersproject/abstract-signer'\nimport { CallOverrides } from '@ethersproject/contracts'\nimport { computeAddress } from '@ethersproject/transactions'\nimport { computePublicKey } from '@ethersproject/signing-key'\nimport { Provider } from '@ethersproject/providers'\nimport { Wallet } from '@ethersproject/wallet'\nimport * as base64 from '@ethersproject/base64'\nimport { hexlify, hexValue, isBytes } from '@ethersproject/bytes'\nimport { Base58 } from '@ethersproject/basex'\nimport { toUtf8Bytes } from '@ethersproject/strings'\nimport { EthrDidController, interpretIdentifier, MetaSignature, REGISTRY } from 'ethr-did-resolver'\nimport { Resolvable } from 'did-resolver'\nimport { ec as EC } from 'elliptic';\n\nexport enum DelegateTypes {\n  veriKey = 'veriKey',\n  sigAuth = 'sigAuth',\n  enc = 'enc',\n}\n\ninterface IConfig {\n  identifier: string\n  chainNameOrId?: string | number\n\n  registry?: string\n\n  signer?: JWTSigner\n  alg?: 'ES256K' | 'ES256K-R'\n  txSigner?: TxSigner\n  privateKey?: string\n\n  rpcUrl?: string\n  provider?: Provider\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  web3?: any\n}\n\nexport type KeyPair = {\n  address: string\n  privateKey: string\n  publicKey: string\n  identifier: string\n}\n\ntype DelegateOptions = {\n  delegateType?: DelegateTypes\n  expiresIn?: number\n}\n\nexport class EthrDID {\n  public did: string\n  public address: string\n  public signer?: JWTSigner\n  public alg?: 'ES256K' | 'ES256K-R'\n  private owner?: string\n  private controller?: EthrDidController\n\n  constructor(conf: IConfig) {\n    const { address, publicKey, network } = interpretIdentifier(conf.identifier)\n    const chainNameOrId = typeof conf.chainNameOrId === 'number' ? hexValue(conf.chainNameOrId) : conf.chainNameOrId\n    if (conf.provider || conf.rpcUrl || conf.web3) {\n      let txSigner = conf.txSigner\n      if (conf.privateKey && typeof txSigner === 'undefined') {\n        txSigner = new Wallet(conf.privateKey)\n      }\n      this.controller = new EthrDidController(\n        conf.identifier,\n        undefined,\n        txSigner,\n        chainNameOrId,\n        conf.provider || conf.web3?.currentProvider,\n        conf.rpcUrl,\n        conf.registry || REGISTRY\n      )\n      this.did = this.controller.did\n    } else {\n      const net = network || chainNameOrId\n      let networkString = net ? `${net}:` : ''\n      if (networkString in ['mainnet:', '0x1:']) {\n        networkString = ''\n      }\n      this.did =\n        typeof publicKey === 'string' ? `did:ethr:${networkString}${publicKey}` : `did:ethr:${networkString}${address}`\n    }\n    this.address = address\n    if (conf.signer) {\n      this.signer = conf.signer\n      this.alg = conf.alg\n      if (!this.alg) {\n        console.warn(\n          'A JWT signer was specified but no algorithm was set. Please set the `alg` parameter when calling `new EthrDID()`'\n        )\n      }\n    } else if (conf.privateKey) {\n      this.signer = ES256KSigner(hexToBytes(conf.privateKey), true)\n      this.alg = 'ES256K-R'\n    }\n  }\n\n  static createKeyPair(chainNameOrId?: string | number): KeyPair {\n    const ec = new EC('p256'); // 'p256' is another name for secp256r1\n\n// Generate a key pair\n    const keyPair = ec.genKeyPair();\n    const privateKey = '0x' + keyPair.getPrivate('hex');\n    const address = computeAddress(privateKey)\n    const publicKey = computePublicKey(privateKey, true)\n    const net = typeof chainNameOrId === 'number' ? hexValue(chainNameOrId) : chainNameOrId\n    const identifier = net ? `did:ethr:${net}:${publicKey}` : publicKey\n    return { address, privateKey, publicKey, identifier }\n  }\n\n  async lookupOwner(cache = true): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    if (cache && this.owner) return this.owner\n    return this.controller?.getOwner(this.address)\n  }\n\n  async changeOwner(newOwner: string, txOptions?: CallOverrides): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.changeOwner(newOwner, {\n      ...txOptions,\n      from: owner,\n    })\n    this.owner = newOwner\n    return receipt.transactionHash\n  }\n\n  async createChangeOwnerHash(newOwner: string): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createChangeOwnerHash(newOwner)\n  }\n\n  async changeOwnerSigned(newOwner: string, signature: MetaSignature, txOptions: CallOverrides): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.changeOwnerSigned(newOwner, signature, txOptions)\n    this.owner = newOwner\n    return receipt.transactionHash\n  }\n\n  async addDelegate(\n    delegate: string,\n    delegateOptions?: DelegateOptions,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.addDelegate(\n      delegateOptions?.delegateType || DelegateTypes.veriKey,\n      delegate,\n      delegateOptions?.expiresIn || 86400,\n      { ...txOptions, from: owner }\n    )\n    return receipt.transactionHash\n  }\n\n  async createAddDelegateHash(delegateType: string, delegateAddress: string, exp: number): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createAddDelegateHash(delegateType, delegateAddress, exp)\n  }\n\n  async addDelegateSigned(\n    delegate: string,\n    signature: MetaSignature,\n    delegateOptions?: DelegateOptions,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.addDelegateSigned(\n      delegateOptions?.delegateType || DelegateTypes.veriKey,\n      delegate,\n      delegateOptions?.expiresIn || 86400,\n      signature,\n      txOptions\n    )\n    return receipt.transactionHash\n  }\n\n  async revokeDelegate(\n    delegate: string,\n    delegateType = DelegateTypes.veriKey,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.revokeDelegate(delegateType, delegate, { ...txOptions, from: owner })\n    return receipt.transactionHash\n  }\n\n  async createRevokeDelegateHash(delegateType: string, delegateAddress: string): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createRevokeDelegateHash(delegateType, delegateAddress)\n  }\n\n  async revokeDelegateSigned(\n    delegate: string,\n    delegateType = DelegateTypes.veriKey,\n    signature: MetaSignature,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.revokeDelegateSigned(delegateType, delegate, signature, txOptions)\n    return receipt.transactionHash\n  }\n\n  async setAttribute(\n    key: string,\n    value: string | Uint8Array,\n    expiresIn = 86400,\n    /** @deprecated please use `txOptions.gasLimit` */\n    gasLimit?: number,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.setAttribute(key, attributeToHex(key, value), expiresIn, {\n      gasLimit,\n      ...txOptions,\n      from: owner,\n    })\n    return receipt.transactionHash\n  }\n\n  async createSetAttributeHash(attrName: string, attrValue: string, exp: number) {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createSetAttributeHash(attrName, attrValue, exp)\n  }\n\n  async setAttributeSigned(\n    key: string,\n    value: string | Uint8Array,\n    expiresIn = 86400,\n    signature: MetaSignature,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.setAttributeSigned(\n      key,\n      attributeToHex(key, value),\n      expiresIn,\n      signature,\n      txOptions\n    )\n    return receipt.transactionHash\n  }\n\n  async revokeAttribute(\n    key: string,\n    value: string | Uint8Array,\n    /** @deprecated please use `txOptions.gasLimit` */\n    gasLimit?: number,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const owner = await this.lookupOwner()\n    const receipt = await this.controller.revokeAttribute(key, attributeToHex(key, value), {\n      gasLimit,\n      ...txOptions,\n      from: owner,\n    })\n    return receipt.transactionHash\n  }\n\n  async createRevokeAttributeHash(attrName: string, attrValue: string) {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    return this.controller.createRevokeAttributeHash(attrName, attrValue)\n  }\n\n  async revokeAttributeSigned(\n    key: string,\n    value: string | Uint8Array,\n    signature: MetaSignature,\n    txOptions: CallOverrides = {}\n  ): Promise<string> {\n    if (typeof this.controller === 'undefined') {\n      throw new Error('a web3 provider configuration is needed for network operations')\n    }\n    const receipt = await this.controller.revokeAttributeSigned(key, attributeToHex(key, value), signature, txOptions)\n    return receipt.transactionHash\n  }\n\n  // Create a temporary signing delegate able to sign JWT on behalf of identity\n  async createSigningDelegate(\n    delegateType = DelegateTypes.veriKey,\n    expiresIn = 86400\n  ): Promise<{ kp: KeyPair; txHash: string }> {\n    const kp = EthrDID.createKeyPair()\n    this.signer = ES256Signer(hexToBytes(kp.privateKey))\n    const txHash = await this.addDelegate(kp.address, {\n      delegateType,\n      expiresIn,\n    })\n    return { kp, txHash }\n  }\n\n  // eslint-disable-next-line\n  async signJWT(payload: any, expiresIn?: number): Promise<string> {\n    if (typeof this.signer !== 'function') {\n      throw new Error('No signer configured')\n    }\n    const options = {\n      signer: this.signer,\n      alg: 'ES256',\n      issuer: this.did,\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if (expiresIn) (<any>options)['expiresIn'] = expiresIn\n    return createJWT(payload, options)\n  }\n\n  async verifyJWT(jwt: string, resolver: Resolvable, audience = this.did): Promise<JWTVerified> {\n    return verifyJWT(jwt, { resolver, audience })\n  }\n}\n\nfunction attributeToHex(key: string, value: string | Uint8Array): string {\n  if (value instanceof Uint8Array || isBytes(value)) {\n    return hexlify(value)\n  }\n  const matchKeyWithEncoding = key.match(/^did\\/(pub|auth|svc)\\/(\\w+)(\\/(\\w+))?(\\/(\\w+))?$/)\n  const encoding = matchKeyWithEncoding?.[6]\n  const matchHexString = (<string>value).match(/^0x[0-9a-fA-F]*$/)\n  if (encoding && !matchHexString) {\n    if (encoding === 'base64') {\n      return hexlify(base64.decode(value))\n    }\n    if (encoding === 'base58') {\n      return hexlify(Base58.decode(value))\n    }\n  } else if (matchHexString) {\n    return <string>value\n  }\n\n  return hexlify(toUtf8Bytes(value))\n}\n"],"names":["DelegateTypes","EthrDID","constructor","conf","did","address","signer","alg","owner","controller","publicKey","network","interpretIdentifier","identifier","chainNameOrId","hexValue","provider","rpcUrl","web3","txSigner","privateKey","Wallet","EthrDidController","undefined","currentProvider","registry","REGISTRY","net","networkString","console","warn","ES256KSigner","hexToBytes","createKeyPair","ec","EC","keyPair","genKeyPair","getPrivate","computeAddress","computePublicKey","lookupOwner","cache","Error","getOwner","changeOwner","newOwner","txOptions","from","receipt","transactionHash","createChangeOwnerHash","changeOwnerSigned","signature","addDelegate","delegate","delegateOptions","delegateType","veriKey","expiresIn","createAddDelegateHash","delegateAddress","exp","addDelegateSigned","revokeDelegate","createRevokeDelegateHash","revokeDelegateSigned","setAttribute","key","value","gasLimit","attributeToHex","createSetAttributeHash","attrName","attrValue","setAttributeSigned","revokeAttribute","createRevokeAttributeHash","revokeAttributeSigned","createSigningDelegate","kp","ES256Signer","txHash","signJWT","payload","options","issuer","createJWT","verifyJWT","jwt","resolver","audience","Uint8Array","isBytes","hexlify","matchKeyWithEncoding","match","encoding","matchHexString","base64","decode","Base58","toUtf8Bytes"],"mappings":"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"}